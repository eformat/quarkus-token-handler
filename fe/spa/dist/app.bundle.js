(()=>{"use strict";var e,t={960:(e,t,n)=>{var a=n(378),r=n(542);class s{constructor(e){this.key="demoapp.loggedout",this.onLoggedOut=e,this.setupCallbacks()}setLoggedOut(e){localStorage.setItem(this.key,String(e))}async onChange(e){e.storageArea==localStorage&&e.key===this.key&&"true"===e.newValue&&this.onLoggedOut()}setupCallbacks(){this.onChange=this.onChange.bind(this)}}function o(e){const[t,n]=(0,a.useState)({welcomeMessage:"",error:null});return a.createElement("div",{className:"container"},a.createElement("h2",null,"Call APIs"),a.createElement("p",null,"The SPA makes all API calls using SameSite cookies, with no tokens in the browser"),a.createElement("button",{id:"getApiData",className:"btn btn-primary operationButton",onClick:async function(){try{const t=await e.apiClient.getWelcomeData();t.message&&n((e=>Object.assign(Object.assign({},e),{welcomeMessage:t.message,error:null})))}catch(t){const a=t;a&&(401===a.getStatus()?e.onSessionExpired():n((e=>Object.assign(Object.assign({},e),{welcomeMessage:"",error:a.toDisplayFormat()}))))}},disabled:!1},"Get Data"),t&&t.welcomeMessage&&a.createElement("div",null,a.createElement("p",{className:"alert alert-success",id:"getDataResult"},t.welcomeMessage)),t&&t.error&&a.createElement("div",null,a.createElement("p",{className:"alert alert-danger",id:"getDataErrorResult"},t.error)),a.createElement("hr",null))}function i(){return a.createElement("div",{className:"container"},a.createElement("h2",null,"Multi Tab Browsing"),a.createElement("p",null,"All browser tabs share the SameSite cookie and use it when calling APIs"),a.createElement("button",{id:"multiTab",className:"btn btn-primary operationButton",onClick:async function(){window.open(location.href)},disabled:!1},"Open New Browser Tab"),a.createElement("hr",null))}function l(e){const[t,n]=(0,a.useState)({isLoaded:!1,error:null});return(0,a.useEffect)((()=>{!async function(){try{const{handled:t,isLoggedIn:a}=await async function(){return e.sessionExpired?{handled:!1,isLoggedIn:!1}:await e.oauthClient.handlePageLoad(location.href)}();t&&history.replaceState({},document.title,"/"),e.setIsLoaded(),n((e=>Object.assign(Object.assign({},e),{isLoaded:!0}))),a&&e.setIsLoggedIn()}catch(e){const t=e;t&&n((e=>Object.assign(Object.assign({},e),{error:t.toDisplayFormat()})))}}()}),[]),a.createElement("div",{className:"container"},a.createElement("div",null,a.createElement("h2",null,"Page Load"),a.createElement("p",null,"When the SPA loads it asks the API for the authenticated state and to handle a login response if required"),t&&t.isLoaded&&!t.error&&a.createElement("div",null,a.createElement("p",{className:"alert alert-success",id:"pageLoadResult"},"Authentication required")),t&&t.error&&a.createElement("div",null,a.createElement("p",{className:"alert alert-danger",id:"pageLoadErrorResult"},t.error)),a.createElement("hr",null)))}function c(e){const[t,n]=(0,a.useState)({error:null});return a.createElement("div",{className:"container"},a.createElement("h2",null,"Sign Out"),a.createElement("p",null,"The SPA asks the API for the End Session Redirect URL, then manages its own redirect"),a.createElement("button",{id:"signOut",className:"btn btn-primary operationButton",onClick:async function(){try{const t=await e.oauthClient.logout();e.setIsLoggedOut(),location.href=t}catch(e){const t=e;t&&n((e=>Object.assign(Object.assign({},e),{error:t.toDisplayFormat()})))}},disabled:!1},"Sign Out"),t&&t.error&&a.createElement("div",null,a.createElement("p",{className:"alert alert-danger",id:"signOutErrorResult"},t.error)),a.createElement("hr",null))}function u(e){const[t,n]=(0,a.useState)({error:null});return a.createElement("div",{className:"container"},a.createElement("h2",null,"Refresh"),a.createElement("p",null,"The SPA asks the API for to refresh encrypted cookies using the refresh token"),a.createElement("button",{id:"signOut",className:"btn btn-primary operationButton",onClick:async function(){try{await e.oauthClient.refresh()}catch(t){const a=t;a&&(401===a.getStatus()?e.onSessionExpired():n((e=>Object.assign(Object.assign({},e),{welcomeMessage:"",error:a.toDisplayFormat()}))))}},disabled:!1},"Refresh"),t&&t.error&&a.createElement("div",null,a.createElement("p",{className:"alert alert-danger",id:"signOutErrorResult"},t.error)),a.createElement("hr",null))}function d(e){const[t,n]=(0,a.useState)({error:null});return a.createElement("div",{className:"container"},a.createElement("h2",null,"Start Authentication"),a.createElement("p",null,"The SPA asks the Token Handler for the Authorization Redirect URL, then manages its own redirect"),a.createElement("div",null,a.createElement("button",{id:"startAuthentication",className:"btn btn-primary operationButton",onClick:async function(){try{location.href=await e.oauthClient.startLogin()}catch(e){const t=e;t&&n((e=>Object.assign(Object.assign({},e),{authorizationUrl:"",error:t.toDisplayFormat()})))}},disabled:!1},"Sign In")),t&&t.error&&a.createElement("div",null,a.createElement("p",{className:"alert alert-danger",id:"getDataErrorResult"},t.error)),a.createElement("hr",null))}function h(){return a.createElement("div",{className:"container spacer"},a.createElement("h1",null,"Single Page App using OpenID Connect"),a.createElement("p",{className:"green"},"A Web Client that uses strongest browser security via a Token Handler"),a.createElement("hr",null))}function g(e){const[t,n]=(0,a.useState)({givenName:"",familyName:"",error:null});return a.createElement("div",{className:"container"},a.createElement("h2",null,"Get User Info"),a.createElement("p",null,"The SPA sends the SameSite cookie to the BFF API to get user info from the ID token"),a.createElement("button",{id:"getUserInfo",className:"btn btn-primary operationButton",onClick:async function(){try{let t=await e.oauthClient.getUserInfo();t.given_name&&t.family_name&&n((e=>Object.assign(Object.assign({},e),{givenName:t.given_name,familyName:t.family_name,error:null})))}catch(e){const t=e;t&&n((e=>Object.assign(Object.assign({},e),{error:t.toDisplayFormat()})))}},disabled:!1},"Get User Info"),t.givenName&&t.familyName&&a.createElement("div",null,a.createElement("p",{id:"getUserInfoResult",className:"alert alert-success"},`${t.givenName} ${t.familyName}`)),t&&t.error&&a.createElement("div",null,a.createElement("p",{className:"alert alert-danger",id:"getUserInfoErrorResult"},t.error)),a.createElement("hr",null))}var m=n(206),p=n.n(m);class f extends Error{constructor(e,t,n){super(n),this.status=e,this.code=t}getStatus(){return this.status}toDisplayFormat(){const e=[];return this.status&&e.push(`Status: ${this.status}`),this.code&&e.push(`Code: ${this.code}`),e.push(this.message),e.join(", ")}}class E{static handleFetchError(e,t){let n=0,a="",r=`Problem encountered calling the ${e}`;return t.response&&(t.response.status&&(n=t.response.status),t.response.data&&"object"==typeof t.response.data&&(t.response.data.code?a=t.response.data.code:t.response.data.error&&(a=t.response.data.error),t.response.data.message?r+=`: ${t.response.data.message}`:t.response.data.error_description&&(r+=`: ${t.response.data.error_description}`))),new f(n,a,r)}}class b{constructor(e,t){this.apiBaseUrl=e,this.oauthClient=t}async getWelcomeData(){return await this.fetch("POST","data")}async fetch(e,t){try{return await this.fetchImpl(e,t)}catch(n){if(!this.isApi401Error(n))throw E.handleFetchError("Business API",n);await this.oauthClient.refresh();try{return await this.fetchImpl(e,t)}catch(e){throw E.handleFetchError("Business API",e)}}}async fetchImpl(e,t){const n={url:`${this.apiBaseUrl}/${t}`,method:e,headers:{accept:"application/json","content-type":"application/json"},withCredentials:!0},a=this.oauthClient.getAntiForgeryToken();a&&(n.headers["x-example-csrf"]=a);const r=await p().request(n);return r.data?r.data:null}isApi401Error(e){return!(!e.response||401!==e.response.status&&403!==e.response.status)}}class y{constructor(e){this.configuration=e,this.antiForgeryToken=null,this.setupCallbacks()}getAntiForgeryToken(){return this.antiForgeryToken}async handlePageLoad(e){const t=JSON.stringify({pageUrl:e}),n=await this.fetch("POST","login/end",t);return n&&n.csrf&&(this.antiForgeryToken=n.csrf),n}async startLogin(){return(await this.fetch("POST","login/start",null)).authorizationRequestUrl}async getUserInfo(){return await this.fetch("GET","userInfo",null)}async refresh(){await this.fetch("POST","refresh",null)}async logout(){const e=await this.fetch("POST","logout",null);return this.antiForgeryToken=null,e.url}async onLoggedOut(){this.antiForgeryToken=null}async fetch(e,t,n){const a={url:`${this.configuration.tokenHandlerBaseUrl}/${t}`,method:e,headers:{accept:"application/json","content-type":"application/json"},withCredentials:!0};n&&(a.data=n),this.antiForgeryToken&&(a.headers["x-example-csrf"]=this.antiForgeryToken);try{const e=await p().request(a);return e.data?e.data:null}catch(e){throw E.handleFetchError("Token Handler",e)}}setupCallbacks(){this.onLoggedOut=this.onLoggedOut.bind(this)}}const w={viewModel:new class{constructor(){this.configuration=null,this.oauthClient=null,this.apiClient=null,this.storage=null}async initialize(e){const t=await fetch("config.json");this.configuration=await t.json(),this.oauthClient=new y(this.configuration.oauth),this.apiClient=new b(this.configuration.businessApiBaseUrl,this.oauthClient),this.storage=e}}};r.render(a.createElement((function(e){const[t,n]=(0,a.useState)(null);function r(){n((e=>Object.assign(Object.assign({},e),{isLoggedIn:!1,sessionExpired:!0})))}function m(){e.viewModel.storage.setLoggedOut(!0),n((e=>Object.assign(Object.assign({},e),{isLoggedIn:!1,sessionExpired:!0})))}return(0,a.useEffect)((()=>(async function(){const t=new s((()=>async function(){await e.viewModel.oauthClient.onLoggedOut(),m()}()));await e.viewModel.initialize(t),window.addEventListener("storage",t.onChange),n({isLoaded:!1,isLoggedIn:!1,sessionExpired:!1})}(),()=>{e.viewModel.storage&&window.removeEventListener("storage",e.viewModel.storage.onChange)})),[]),a.createElement(a.Fragment,null,a.createElement(h,null),t&&!t.isLoggedIn&&a.createElement(a.Fragment,null,a.createElement(l,{oauthClient:e.viewModel.oauthClient,sessionExpired:t.sessionExpired,setIsLoaded:function(){n((e=>Object.assign(Object.assign({},e),{isLoaded:!0})))},setIsLoggedIn:function(){e.viewModel.storage.setLoggedOut(!1),n((e=>Object.assign(Object.assign({},e),{isLoggedIn:!0,sessionExpired:!1})))}}),t.isLoaded&&a.createElement(a.Fragment,null,a.createElement(d,{oauthClient:e.viewModel.oauthClient}))),t&&t.isLoaded&&t.isLoggedIn&&a.createElement(a.Fragment,null,a.createElement(i,null),a.createElement(g,{oauthClient:e.viewModel.oauthClient}),a.createElement(o,{apiClient:e.viewModel.apiClient,onSessionExpired:r}),a.createElement(u,{oauthClient:e.viewModel.oauthClient,onSessionExpired:r}),a.createElement(c,{oauthClient:e.viewModel.oauthClient,setIsLoggedOut:m})))}),Object.assign({},w)),document.getElementById("root"))}},n={};function a(e){var r=n[e];if(void 0!==r)return r.exports;var s=n[e]={exports:{}};return t[e](s,s.exports,a),s.exports}a.m=t,e=[],a.O=(t,n,r,s)=>{if(!n){var o=1/0;for(u=0;u<e.length;u++){for(var[n,r,s]=e[u],i=!0,l=0;l<n.length;l++)(!1&s||o>=s)&&Object.keys(a.O).every((e=>a.O[e](n[l])))?n.splice(l--,1):(i=!1,s<o&&(o=s));if(i){e.splice(u--,1);var c=r();void 0!==c&&(t=c)}}return t}s=s||0;for(var u=e.length;u>0&&e[u-1][2]>s;u--)e[u]=e[u-1];e[u]=[n,r,s]},a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={143:0};a.O.j=t=>0===e[t];var t=(t,n)=>{var r,s,[o,i,l]=n,c=0;if(o.some((t=>0!==e[t]))){for(r in i)a.o(i,r)&&(a.m[r]=i[r]);if(l)var u=l(a)}for(t&&t(n);c<o.length;c++)s=o[c],a.o(e,s)&&e[s]&&e[s][0](),e[o[c]]=0;return a.O(u)},n=self.webpackChunk=self.webpackChunk||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var r=a.O(void 0,[736],(()=>a(960)));r=a.O(r)})();